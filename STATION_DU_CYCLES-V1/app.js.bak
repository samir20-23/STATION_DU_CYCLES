// ================== I18N ==================
const I18N = {
  ar: {
    dir: 'rtl', lang: 'ar',
    banner: { delivery: ' ğŸš€ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„Ø³Ø±Ø¹Ø© ÙˆØ§Ù„Ø¥Ø«Ø§Ø±Ø© â€“ Ø§ÙƒØªØ´Ù Ø£ÙØ¶Ù„ Ø§Ù„Ø¯Ø±Ø§Ø¬Ø§Øª Ø§Ù„Ù†Ø§Ø±ÙŠØ© Ù„Ø¯ÙŠÙ†Ø§ Ø§Ù„ÙŠÙˆÙ…! ğŸï¸ğŸ”¥' },
    nav: { home: 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', brands: 'Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª', storeInfo: 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø­Ù„', hours: 'ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù…Ø­Ù„' },
    home: { brandsTitle: 'Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø©', viewDetails: 'Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„' },
    storeInfo: { title:'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±', phone:'Ø§Ù„Ù‡Ø§ØªÙ', address:'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†', mapTitle:'Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©' },
    hours: {
      title:'Store Hours', opening:'Opening Hours', today: "Today's Status",
      openNow:'Ù…ÙØªÙˆØ­ Ø§Ù„ÙŠÙˆÙ…', closedToday:'Ù…ØºÙ„Ù‚ Ø§Ù„ÙŠÙˆÙ…',
      notesTitle:'Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø®Ø§ØµØ©', note1:'â€¢ Ù…ØºÙ„Ù‚ ÙŠÙˆÙ… Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', note2:'â€¢ Ø¹Ø±ÙˆØ¶ Ø®Ø§ØµØ© ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹', note3:'â€¢ ÙŠÙÙØ¶Ù‘Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ù‚Ø¨Ù„ Ø§Ù„Ø²ÙŠØ§Ø±Ø©',
      days:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday']
    },
    product: { specs:'Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„ØªÙ‚Ù†ÙŠØ©', ratingOf:'Ù…Ù† 5', buy:'Ø§Ø´ØªØ±Ù Ø§Ù„Ø¢Ù†', whatsapp:'ØªÙˆØ§ØµÙ„ ÙˆØ§ØªØ³Ø§Ø¨',
      breadcrumbHome:'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©'
    },
    cta: { title:'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¯Ø±Ø§Ø¬Ø© Ù…Ù†Ø§Ø³Ø¨Ø© Ù„ÙƒØŸ', subtitle:'Ø§ØªØ±Ùƒ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ ÙˆØ³Ù†ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ ÙÙˆØ±Ø§Ù‹ Ù„ØªÙ‚Ø¯ÙŠÙ… Ø£ÙØ¶Ù„ Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªÙ…ÙˆÙŠÙ„.' },
    form: {
      fullName:{label:'Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *', placeholder:'Ù…Ø«Ù„: Ù…ØµØ·ÙÙ‰ Ø£Ø­Ù…Ø¯'},
      phone:{label:'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *', placeholder:'+212 6 00 00 00 00'},
      city:{label:'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©', placeholder:'Ø§Ù„Ø¯Ø§Ø± Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ / Ø·Ù†Ø¬Ø© / ÙØ§Ø³ ...'},
      model:{label:'Ø§Ù„Ù…Ø§Ø±ÙƒØ© / Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)'},
      message:{label:'Ø±Ø³Ø§Ù„ØªÙƒ', placeholder:'Ø§Ø°ÙƒØ± Ù…ÙŠØ²Ø§Ù†ÙŠØªÙƒØŒ Ù†ÙˆØ¹ Ø§Ù„Ø§Ø³ØªØ¹Ù…Ø§Ù„ØŒ Ø£Ùˆ Ø£ÙŠ Ø³Ø¤Ø§Ù„ ÙŠØ®Ø·Ø± Ø¨Ø¨Ø§Ù„Ùƒ...'},
      agree:'Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨ÙŠ Ø¹Ø¨Ø± Ø§Ù„Ù‡Ø§ØªÙ Ø£Ùˆ ÙˆØ§ØªØ³Ø§Ø¨ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ÙˆØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¹Ø±ÙˆØ¶.',
      send:'Ø£Ø±Ø³Ù„ Ø·Ù„Ø¨ÙŠ Ø§Ù„Ø¢Ù†', whatsapp:'ØªÙˆØ§ØµÙ„ ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø¨Ø§Ø´Ø±', success:'âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! Ø³Ù†ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ø¬Ø¯Ø§Ù‹.'
    },
    footer:{
      about:'Ù…ØªØ®ØµØµÙˆÙ† ÙÙŠ Ø¨ÙŠØ¹ Ø§Ù„Ø¯Ø±Ø§Ø¬Ø§Øª Ø§Ù„Ù†Ø§Ø±ÙŠØ© ÙˆØ§Ù„Ø³ÙƒÙˆØªØ±Ø§Øª Ù…Ø¹ Ø¶Ù…Ø§Ù† ÙˆØ®Ø¯Ù…Ø§Øª Ù…Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ¹. Ø§Ø®ØªÙØ± Ø±Ø§Ø­ØªÙƒ ÙˆØ³Ù†ÙÙ†Ø¬Ø² Ø§Ù„Ø¨Ø§Ù‚ÙŠ.',
      linksTitle:'Ø±ÙˆØ§Ø¨Ø·', offers:'Ø¹Ø±ÙˆØ¶ ÙˆØªÙ…ÙˆÙŠÙ„', contact:'Ø§ØªØµÙ„ Ø¨Ù†Ø§',
      hoursTitle:'Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯', hoursRange:'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ† â€“ Ø§Ù„Ø³Ø¨Øª: 9:00â€“19:00', sunday:'Ø§Ù„Ø£Ø­Ø¯: Ù…ØºÙ„Ù‚',
      newsletterTitle:'Ø§Ø´ØªØ±Ùƒ Ù„ÙŠØµÙ„Ùƒ ÙƒÙ„ Ø¬Ø¯ÙŠØ¯', emailPlaceholder:'Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', subscribeBtn:'Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†', subscribed:'ØªÙ… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ù†Ø¬Ø§Ø­ âœ…'
    },
    copyright: 'Â© 2025 Ù…ØµØ·ÙÙ‰ Ù„Ù„Ø¯Ø±Ø§Ø¬Ø§Øª Ø§Ù„Ù†Ø§Ø±ÙŠØ©. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.'
  },
  fr: {
    dir: 'ltr', lang: 'fr',
    banner: { delivery: 'ğŸš€ Bienvenue dans le monde de la vitesse et des sensations â€” dÃ©couvrez nos meilleures motos dÃ¨s aujourdâ€™hui ! ğŸï¸ğŸ”¥' },
    nav: { home: 'Accueil', brands: 'Marques', storeInfo: 'Infos Magasin', hours: 'Horaires' },
    home: { brandsTitle: 'Marques disponibles', viewDetails: 'Voir les dÃ©tails' },
    storeInfo: { title:'Informations du magasin', phone:'TÃ©lÃ©phone', address:'Adresse', mapTitle:"Emplacement sur la carte" },
    hours: {
      title:'Horaires du magasin', opening:"Heures d'ouverture", today:"Statut d'aujourd'hui",
      openNow:'Ouvert aujourdâ€™hui', closedToday:'FermÃ© aujourdâ€™hui',
      notesTitle:'Notes', note1:'â€¢ FermÃ© le lundi', note2:'â€¢ Offres spÃ©ciales le week-end', note3:'â€¢ Merci dâ€™appeler avant de venir',
      days:['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi']
    },
    product: { specs:'CaractÃ©ristiques techniques', ratingOf:'sur 5', buy:'Acheter maintenant', whatsapp:'WhatsApp',
      breadcrumbHome:'Accueil'
    },
    cta: { title:'Vous voulez la moto idÃ©ale ?', subtitle:'Laissez vos informations et nous vous contacterons avec les meilleures offres et options de financement.' },
    form: {
      fullName:{label:'Nom complet *', placeholder:'Ex. : Mostafa Ahmad'},
      phone:{label:'TÃ©lÃ©phone *', placeholder:'+212 6 00 00 00 00'},
      city:{label:'Ville', placeholder:'Casablanca / Tanger / FÃ¨s ...'},
      model:{label:'Marque / ModÃ¨le (facultatif)'},
      message:{label:'Message', placeholder:'Budget, type dâ€™usage, ou toute questionâ€¦'},
      agree:"Jâ€™accepte dâ€™Ãªtre contactÃ© par tÃ©lÃ©phone ou WhatsApp pour confirmer la demande et prÃ©senter les offres.",
      send:'Envoyer la demande', whatsapp:'WhatsApp direct', success:'âœ… Votre demande a Ã©tÃ© envoyÃ©e ! Nous vous contacterons trÃ¨s bientÃ´t.'
    },
    footer:{
      about:'SpÃ©cialistes des motos et scooters avec garantie et service aprÃ¨s-vente. Choisissez le confort, on sâ€™occupe du reste.',
      linksTitle:'Liens', offers:'Offres & Financement', contact:'Contactez-nous',
      hoursTitle:'Horaires', hoursRange:'Lun â€“ Sam : 9:00â€“19:00', sunday:'Dimanche : FermÃ©',
      newsletterTitle:'Abonnez-vous', emailPlaceholder:'Votre e-mail', subscribeBtn:'Sâ€™abonner', subscribed:'Abonnement rÃ©ussi âœ…'
    },
    copyright: 'Â© 2025 Mostafa Motos. Tous droits rÃ©servÃ©s.'
  }
};

function t(key){
  const lang = getLang();
  const parts = key.split('.');
  let node = I18N[lang];
  for (const p of parts) node = node?.[p];
  return node ?? key;
}
function getLang(){ return localStorage.getItem('lang') || 'ar'; }
function setLang(lang){
  localStorage.setItem('lang', lang);
  document.documentElement.lang = I18N[lang].lang;
  document.documentElement.dir  = I18N[lang].dir;
  document.getElementById('lang-current')?.replaceChildren(document.createTextNode(lang.toUpperCase()));
  applyTranslations();
  router?.handleRoute();
  const cp = document.getElementById('copyright');
  if (cp) cp.textContent = I18N[lang].copyright;
  const addr = '365, Bd El Fida, Casablanca';
  document.getElementById('store-address-text')?.replaceChildren(document.createTextNode(addr));
  document.getElementById('map-address-small')?.replaceChildren(document.createTextNode(addr));
  document.getElementById('footer-address')?.replaceChildren(document.createTextNode(addr));
  buildHours();
}

// ÙŠØ·Ø¨Ù‘Ù‚ Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø°Ø§Øª data-i18n Ùˆ placeholders
function applyTranslations(){
  const lang = getLang();
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const key = el.getAttribute('data-i18n');
    const val = t(key);
    if (val != null) el.textContent = val;
  });
  document.querySelectorAll('[data-i18n-placeholder]').forEach(el=>{
    const key = el.getAttribute('data-i18n-placeholder');
    const val = t(key);
    if (val != null) el.setAttribute('placeholder', val);
  });
  const dir = I18N[lang].dir;
  document.querySelectorAll('[data-dir-sync]').forEach(el=> el.setAttribute('dir', dir));
}

// ================== THEME (Dark / Light) ==================
const THEME_KEY = 'theme'; // 'dark' | 'light'
function applyTheme(mode){
  const BODY = document.body;
  const iconTheme = document.getElementById('theme-icon');
  if(mode === 'light'){
    BODY.classList.remove('theme-dark','text-white');
    BODY.classList.add('theme-light');
    if(iconTheme) iconTheme.className = 'fa-solid fa-sun';
  }else{
    BODY.classList.remove('theme-light');
    BODY.classList.add('theme-dark','text-white');
    if(iconTheme) iconTheme.className = 'fa-solid fa-moon';
  }
}
function initTheme(){
  let saved = localStorage.getItem(THEME_KEY);
  if(!saved){
    const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    saved = prefersDark ? 'dark' : 'light';
  }
  applyTheme(saved);
  localStorage.setItem(THEME_KEY, saved);

  // ØªØ¨Ø¯ÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø«ÙŠÙ…
  const btnTheme = document.getElementById('theme-toggle');
  if(btnTheme && !btnTheme._bound){
    btnTheme._bound = true;
    btnTheme.addEventListener('click', ()=>{
      const isLight = document.body.classList.contains('theme-light');
      const next = isLight ? 'dark' : 'light';
      applyTheme(next);
      localStorage.setItem(THEME_KEY, next);
    });
  }

  // Ù…ØªØ§Ø¨Ø¹Ø© ØªØºÙŠÙ‘Ø± ØªÙØ¶ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… (Ø¥Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø§ Ø§Ø®ØªØ§Ø±Ø´ ÙŠØ¯ÙˆÙŠØ§Ù‹)
  if(window.matchMedia){
    const mq = window.matchMedia('(prefers-color-scheme: dark)');
    const onChange = e=>{
      const userSet = localStorage.getItem(THEME_KEY);
      if(userSet !== 'dark' && userSet !== 'light'){
        applyTheme(e.matches ? 'dark' : 'light');
      }
    };
    if(mq.addEventListener) mq.addEventListener('change', onChange);
    else mq.addListener(onChange);
  }
}

// ================== DATA ==================
const BRANDS = [
  { id: 'SYM',        name: 'SYM',        description: 'Draisiennes urbaines pratiques et Ã©lÃ©gantes', image: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=600&fit=crop' },
  { id: 'KYMCO',      name: 'KYMCO',      description: 'Performance Ã©levÃ©e et fiabilitÃ© au quotidien', image: 'https://images.unsplash.com/photo-1568772585407-9361f9bf3a87?w=800&h=600&fit=crop' },
  { id: 'FICE_SANYA', name: 'FICE SANYA', description: 'Excellent rapport qualitÃ©-prix', image: 'https://images.unsplash.com/photo-1502877338535-766e1452684a?w=800&h=600&fit=crop' },
  { id: 'LEONARDO',   name: 'LEONARDO SCOTER', description: 'Design Ã©lÃ©gant avec une touche premium', image: 'https://images.unsplash.com/photo-1516727003284-a96541e51e9b?w=800&h=600&fit=crop' },
  { id: 'HENSIM',     name: 'HENSIM',     description: 'Esprit classique, finitions modernes', image: 'https://images.unsplash.com/photo-1571068316344-75bc76f77890?w=800&h=600&fit=crop' },
  { id: 'CAPPUCINO',  name: 'CAPPUCINO',  description: 'Ã‰conomique avec bonne qualitÃ©', image: 'https://images.unsplash.com/photo-1558431382-27bbae175c40?w=800&h=600&fit=crop' },
  { id: 'TZM_CADY',   name: 'TZM CADY C50', description: 'IdÃ©ales pour la ville', image: 'https://images.unsplash.com/photo-1609630875171-b1321377ee65?w=800&h=600&fit=crop' }
];

const PRODUCTS = [
  // SYM
  { id:'sym-orbit2', brandId:'SYM', name:'ORBIT 2', rating:4.5, images:[
    'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1568772585407-9361f9bf3a87?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1449426468159-d96dbf08f19f?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1571068316344-75bc76f77890?w=800&h=600&fit=crop'
  ],
  description:'Moto classique au design Ã©lÃ©gant, idÃ©ale pour la ville.',
  table:{ etat:'Neuf', typeVehicule:'Scooter / Cyclomoteur', marque:'SYM', modele:'ORBIT 2', kilometrage:'0 km', carburant:'Essence â€“ 4-Temps (125 cc)', annee:'2024â€“2025' } },
  { id:'sym-symphony-s', brandId:'SYM', name:'SYMPHONY S', rating:4.8, images:[
    'https://images.unsplash.com/photo-1549921296-3a6694e1c3e8?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1502877338535-766e1452684a?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1571068316344-75bc76f77890?w=800&h=600&fit=crop'
  ],
  description:'SYM SYMPHONY S lÃ©gÃ¨re et Ã©conomique, parfaite pour les trajets courts.',
  table:{ etat:'Neuf', typeVehicule:'Scooter', marque:'SYM', modele:'SYMPHONY S', kilometrage:'0 km', carburant:'Essence â€“ 150cc â€“ 4-Temps', annee:'2024â€“2025' } },
  { id:'sym-fidole2', brandId:'SYM', name:'FIDOLE 2', rating:4.6, images:[
    'https://images.unsplash.com/photo-1606991965781-3cbc5e81df72?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1593642532973-d31b6557fa68?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1449426468159-d96dbf08f19f?w=800&h=600&fit=crop'
  ],
  description:'SYM FIDOLE 2, style classique et performance fiable.',
  table:{ etat:'Neuf', typeVehicule:'Scooter', marque:'SYM', modele:'FIDOLE 2', kilometrage:'0 km', carburant:'Essence â€“ 125cc â€“ 4-Temps', annee:'2024â€“2025' } },

  // KYMCO
  { id:'kymco-agility50', brandId:'KYMCO', name:'AGILITY 50', rating:4.4, images:[
    'https://images.unsplash.com/photo-1558980394-0aaff773e1e5?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1532298229144-0ec0c57515c7?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1571068316344-75bc76f77890?w=800&h=600&fit=crop'
  ],
  description:'KYMCO AGILITY 50, lÃ©gÃ¨re et facile Ã  conduire, parfaite pour dÃ©buter.',
  table:{ etat:'Neuf', typeVehicule:'Scooter', marque:'KYMCO', modele:'AGILITY 50', kilometrage:'0 km', carburant:'Essence â€“ 50cc â€“ 2-Temps', annee:'2024â€“2025' } },

  // FICE SANYA
  { id:'ficesanya-insta-sanya-x', brandId:'FICE_SANYA', name:'INSTA SANYA X', rating:4.2, images:[
    'https://images.unsplash.com/photo-1516727003284-a96541e51e9b?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1502877338535-766e1452684a?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1571068316344-75bc76f77890?w=800&h=600&fit=crop'
  ],
  description:'INSTA SANYA X Ã©conomique, bonne performance en ville.',
  table:{ etat:'Neuf', typeVehicule:'Moto', marque:'FICE SANYA', modele:'INSTA SANYA X', kilometrage:'0 km', carburant:'Essence â€“ 125cc â€“ 4-Temps', annee:'2024â€“2025' } },
  { id:'ficesanya-sanya-r1000', brandId:'FICE_SANYA', name:'SANYA R1000', rating:4.3, images:[
    'https://images.unsplash.com/photo-1622675363314-f1e8a15a69f0?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1516727003284-a96541e51e9b?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1502877338535-766e1452684a?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1571068316344-75bc76f77890?w=800&h=600&fit=crop'
  ],
  description:'SANYA R1000 puissante, adaptÃ©e aux longues distances.',
  table:{ etat:'Neuf', typeVehicule:'Moto', marque:'FICE SANYA', modele:'SANYA R1000', kilometrage:'0 km', carburant:'Essence â€“ 150cc â€“ 4-Temps', annee:'2024â€“2025' } },
  { id:'ficesanya-sanya-x1000', brandId:'FICE_SANYA', name:'SANYA X1000', rating:4.5, images:[
    'https://images.unsplash.com/photo-1502877338535-766e1452684a?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1622675363314-f1e8a15a69f0?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1571068316344-75bc76f77890?w=800&h=600&fit=crop'
  ],
  description:'SANYA X1000 design moderne et performances Ã©levÃ©es.',
  table:{ etat:'Neuf', typeVehicule:'Moto', marque:'FICE SANYA', modele:'SANYA X1000', kilometrage:'0 km', carburant:'Essence â€“ 200cc â€“ 4-Temps', annee:'2024â€“2025' } },

  // LEONARDO SCOTER
  { id:'leonardo-enzo', brandId:'LEONARDO', name:'ENZO', rating:4.7, images:[
    'https://images.unsplash.com/photo-1502877338535-766e1452684a?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1516727003284-a96541e51e9b?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1571068316344-75bc76f77890?w=800&h=600&fit=crop'
  ],
  description:'LEONARDO ENZO, idÃ©ale pour longues distances.',
  table:{ etat:'Neuf', typeVehicule:'Scooter', marque:'LEONARDO', modele:'ENZO', kilometrage:'0 km', carburant:'Essence â€“ 180cc â€“ 4-Temps', annee:'2024â€“2025' } },
  { id:'leonardo-picasso', brandId:'LEONARDO', name:'PICASSO', rating:4.6, images:[
    'https://images.unsplash.com/photo-1516727003284-a96541e51e9b?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1502877338535-766e1452684a?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1571068316344-75bc76f77890?w=800&h=600&fit=crop'
  ],
  description:'LEONARDO PICASSO Ã©lÃ©gante et urbaine.',
  table:{ etat:'Neuf', typeVehicule:'Scooter', marque:'LEONARDO', modele:'PICASSO', kilometrage:'0 km', carburant:'Essence â€“ 150cc â€“ 4-Temps', annee:'2024â€“2025' } },

  // HENSIM
  { id:'hensim-mustang', brandId:'HENSIM', name:'HENSIM MUSTANG', rating:4.5, images:[
    'https://images.unsplash.com/photo-1502877338535-766e1452684a?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1516727003284-a96541e51e9b?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1571068316344-75bc76f77890?w=800&h=600&fit=crop'
  ],
  description:'HENSIM MUSTANG robuste pour conditions difficiles.',
  table:{ etat:'Neuf', typeVehicule:'Moto', marque:'HENSIM', modele:'MUSTANG', kilometrage:'0 km', carburant:'Essence â€“ 200cc â€“ 4-Temps', annee:'2024â€“2025' } },

  // CAPPUCINO
  { id:'cappucino-cappucinos', brandId:'CAPPUCINO', name:'CAPPUCINOS', rating:4.2, images:[
    'https://images.unsplash.com/photo-1558980394-0aaff773e1e5?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1532298229144-0ec0c57515c7?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1571068316344-75bc76f77890?w=800&h=600&fit=crop'
  ],
  description:'CAPPUCINOS design moderne et compact.',
  table:{ etat:'Neuf', typeVehicule:'Scooter', marque:'CAPPUCINO', modele:'CAPPUCINOS', kilometrage:'0 km', carburant:'Essence â€“ 125cc â€“ 4-Temps', annee:'2024â€“2025' } },
  { id:'cappucino-plus', brandId:'CAPPUCINO', name:'CAPPUCINO PLUS', rating:4.3, images:[
    'https://images.unsplash.com/photo-1558980394-0aaff773e1e5?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1532298229144-0ec0c57515c7?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1571068316344-75bc76f77890?w=800&h=600&fit=crop'
  ],
  description:'CAPPUCINO PLUS plus puissante, plus dâ€™espace.',
  table:{ etat:'Neuf', typeVehicule:'Scooter', marque:'CAPPUCINO', modele:'CAPPUCINO PLUS', kilometrage:'0 km', carburant:'Essence â€“ 150cc â€“ 4-Temps', annee:'2024â€“2025' } },
  { id:'cappucino-mokito', brandId:'CAPPUCINO', name:'MOKITO', rating:4.1, images:[
    'https://images.unsplash.com/photo-1558980394-0aaff773e1e5?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1532298229144-0ec0c57515c7?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1571068316344-75bc76f77890?w=800&h=600&fit=crop'
  ],
  description:'MOKITO Ã©conomique et pratique.',
  table:{ etat:'Neuf', typeVehicule:'Scooter', marque:'CAPPUCINO', modele:'MOKITO', kilometrage:'0 km', carburant:'Essence â€“ 110cc â€“ 4-Temps', annee:'2024â€“2025' } },

  // TZM CADY C50
  { id:'tzm-cady-c50-nouveau', brandId:'TZM_CADY', name:'NOUVEAU MODEL', rating:4.0, images:[
    'https://images.unsplash.com/photo-1558980394-0aaff773e1e5?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1532298229144-0ec0c57515c7?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=600&fit=crop',
    'https://images.unsplash.com/photo-1571068316344-75bc76f77890?w=800&h=600&fit=crop'
  ],
  description:'TZM CADY C50 nouveau modÃ¨le, simple et Ã©conomique.',
  table:{ etat:'Neuf', typeVehicule:'Cyclomoteur', marque:'TZM CADY C50', modele:'NOUVEAU MODEL', kilometrage:'0 km', carburant:'Essence â€“ 50cc â€“ 2-Temps', annee:'2024â€“2025' } },
];

// ================== ROUTER ==================
class Router{
  constructor(){
    this.routes = { home:this.renderHome, brand:this.renderBrand, product:this.renderProduct };
    window.addEventListener('hashchange',()=>this.handleRoute());
    window.addEventListener('load',()=>this.handleRoute());
  }
  handleRoute(){
    const hash = window.location.hash.slice(1) || 'home';
    const [route,...params] = hash.split('/');
    (this.routes[route] || this.renderHome).call(this, params);
  }

  renderHome(){
    const content = document.getElementById('main-content');
    content.innerHTML = `
      <section class="hero-bg relative"><div class="absolute inset-0 bg-black/20"></div></section>

      <section id="brands-section" class="container mx-auto px-4 py-14">
        <h2 class="text-4xl font-bold text-center mb-12 neon-glow">${t('home.brandsTitle')}</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          ${BRANDS.map(b=>`
            <div class="card-hover glass rounded-2xl p-6 cursor-pointer" onclick="location.hash='brand/${b.id}'">
              <img src="${b.image}" alt="${b.name}" class="w-full h-48 object-cover rounded-xl mb-4" loading="lazy">
              <h3 class="text-2xl font-bold mb-2 text-blue-400">${b.name}</h3>
              <p class="text-gray-300 mb-4">${b.description}</p>
              <div class="text-center">
                <span class="inline-block bg-gradient-to-r from-blue-500 to-purple-600 text-white px-4 py-2 rounded-full text-sm font-medium">${t('home.viewDetails')}</span>
              </div>
            </div>
          `).join('')}
        </div>
      </section>
    `;
    enableSmoothNav();
  }

  renderBrand(params){
    const brandId = params[0];
    const brand = BRANDS.find(b=>b.id===brandId);
    if(!brand){ location.hash='home'; return; }
    const items = PRODUCTS.filter(p=>p.brandId===brandId);

    const content = document.getElementById('main-content');
    content.innerHTML = `
      <section class="container mx-auto px-4 py-8" data-dir-sync>
        <nav class="mb-8">
          <a href="#home" class="text-blue-400 hover:text-blue-300">${t('product.breadcrumbHome')}</a>
          <span class="mx-2 text-gray-500">â†</span>
          <span class="text-white">${brand.name}</span>
        </nav>
        <div class="text-center mb-12">
          <h1 class="text-5xl font-black mb-4 hero-title">${brand.name}</h1>
          <p class="text-xl text-gray-300">${brand.description}</p>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          ${items.map(p=>`
            <div class="card-hover glass rounded-2xl overflow-hidden">
              <img src="${p.images[0]}" alt="${p.name}" class="w-full h-48 object-cover cursor-pointer" onclick="location.hash='product/${p.id}'" loading="lazy">
              <div class="p-6">
                <h3 class="text-xl font-bold mb-2">${p.name}</h3>
                <div class="flex items-center mb-3">
                  ${generateStars(p.rating)}
                  <span class="mr-2 text-gray-400">(${p.rating})</span>
                </div>
                <p class="text-gray-300 mb-4">${p.description.slice(0,90)}...</p>
                <div class="flex justify-end">
                  <button onclick="location.hash='product/${p.id}'" class="btn-primary px-4 py-2 rounded-lg text-sm">${t('home.viewDetails')}</button>
                </div>
              </div>
            </div>
          `).join('')}
        </div>
      </section>
    `;
    enableSmoothNav();
  }

  renderProduct(params){
    const productId = params[0];
    const product = PRODUCTS.find(p=>p.id===productId);
    const brand = BRANDS.find(b=>b.id===product?.brandId);
    if(!product || !brand){ location.hash='home'; return; }

    const content = document.getElementById('main-content');
    content.innerHTML = `
      <section class="container mx-auto px-4 py-8" data-dir-sync>
        <nav class="mb-8">
          <a href="#home" class="text-blue-400 hover:text-blue-300">${t('product.breadcrumbHome')}</a>
          <span class="mx-2 text-gray-500">â†</span>
          <a href="#brand/${brand.id}" class="text-blue-400 hover:text-blue-300">${brand.name}</a>
          <span class="mx-2 text-gray-500">â†</span>
          <span class="text-white">${product.name}</span>
        </nav>

        <div class="grid lg:grid-cols-2 gap-12">
          <div>
            <img id="main-image" src="${product.images[0]}" alt="${product.name}" class="w-full h-80 object-cover rounded-2xl mb-4">
            <div class="grid grid-cols-4 gap-2">
              ${product.images.map((img,i)=>`
                <img src="${img}" class="h-20 object-cover rounded-lg cursor-pointer thumbnail ${i===0?'thumbnail-active':''}"
                     onclick="changeMainImage('${img}', this)" loading="lazy" alt="${product.name} ${i+1}">
              `).join('')}
            </div>
          </div>

          <div>
            <h1 class="text-4xl font-bold mb-4">${product.name}</h1>
            <div class="flex items-center mb-6">
              ${generateStars(product.rating)}
              <span class="mr-3 text-gray-400">(${product.rating} ${t('product.ratingOf')})</span>
            </div>
            <p class="text-gray-300 mb-6 text-lg leading-relaxed">${product.description}</p>

            <div class="glass rounded-2xl p-6 mb-8">
              <h3 class="text-xl font-bold mb-4 text-blue-400">${t('product.specs')}</h3>
              <div class="space-y-3">
                ${Object.entries(product.table).map(([k,v])=>`
                  <div class="flex justify-between border-b border-gray-700 pb-2">
                    <span class="text-gray-400">${getTableKeyName(k)}</span>
                    <span class="font-medium">${v}</span>
                  </div>
                `).join('')}
              </div>
            </div>

            <div class="flex flex-col sm:flex-row gap-4">
              <button onclick="openPurchaseModal('${product.id}')" class="flex-1 btn-primary py-4 px-8 text-xl font-bold rounded-2xl">${t('product.buy')}</button>
              <button onclick="openWhatsApp()" class="flex-1 bg-green-600 hover:bg-green-700 py-4 px-8 text-xl font-bold rounded-2xl transition-all">${t('product.whatsapp')}</button>
            </div>
          </div>
        </div>
      </section>
    `;
    enableSmoothNav();
  }
}

let router = null;

// ================== UTILS ==================
function generateStars(r){
  const f=Math.floor(r), half=r%1>=0.5, empty=5-f-(half?1:0);
  let h=''; for(let i=0;i<f;i++) h+='<i class="fas fa-star text-yellow-400"></i>';
  if(half) h+='<i class="fas fa-star-half-alt text-yellow-400"></i>';
  for(let i=0;i<empty;i++) h+='<i class="far fa-star text-gray-400"></i>';
  return h;
}
function getTableKeyName(k){
  const lang = getLang();
  const mapAR={ etat:'Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø©', typeVehicule:'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©', marque:'Ø§Ù„Ù…Ø§Ø±ÙƒØ©', modele:'Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„', kilometrage:'Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±Ø§Øª', carburant:'Ù†ÙˆØ¹ Ø§Ù„ÙˆÙ‚ÙˆØ¯', annee:'Ø§Ù„Ø³Ù†Ø©' };
  const mapFR={ etat:'Ã‰tat', typeVehicule:'Type de vÃ©hicule', marque:'Marque', modele:'ModÃ¨le', kilometrage:'KilomÃ©trage', carburant:'Carburant', annee:'AnnÃ©e' };
  return (lang==='ar'?mapAR:mapFR)[k] || k;
}
function changeMainImage(src, el){
  const main=document.getElementById('main-image'); if(main) main.src=src;
  document.querySelectorAll('.thumbnail').forEach(t=>t.classList.remove('thumbnail-active'));
  el.classList.add('thumbnail-active');
}
function openWhatsApp(){ window.open('https://wa.me/212608788782','_blank'); }

// Ø³ÙƒØ±ÙˆÙ„ Ù†Ø§Ø¹Ù… + ØªÙØ¹ÙŠÙ„ Ø²Ø± Ù†Ø´Ø·
function enableSmoothNav(){
  document.querySelectorAll('a.nav-cta, footer a[href^="index.html#"], footer a[href^="#"]').forEach(a=>{
    if (a._bound) return; a._bound = true;
    a.addEventListener('click', e=>{
      const href = a.getAttribute('href') || '';
      const hash = href.includes('#') ? ('#' + href.split('#')[1]) : '';
      if(hash){
        const target = document.querySelector(hash);
        if (target) {
          e.preventDefault();
          target.scrollIntoView({behavior:'smooth', block:'start'});
          document.querySelectorAll('a.nav-cta').forEach(x=>x.classList.remove('active'));
          if(a.classList.contains('nav-cta')) a.classList.add('active');
        }
      }
    });
  });

  const goBrands = document.getElementById('go-brands');
  if (goBrands && !goBrands._bound){
    goBrands._bound = true;
    goBrands.addEventListener('click', function (e) {
      const mc = document.getElementById('main-content');
      if (!mc) return;
      const candidates = [
        '#main-content #brands',
        '#main-content section#brands',
        '#main-content [id*="brands"]',
        '#main-content [class*="brands"]',
        '#main-content [id*="brand"]',
        '#main-content [class*="brand"]'
      ];
      let target = null;
      for (const sel of candidates) {
        const el = document.querySelector(sel);
        if (el) { target = el; break; }
      }
      if (target) {
        e.preventDefault();
        target.scrollIntoView({behavior:'smooth', block:'start'});
        document.querySelectorAll('a.nav-cta').forEach(x=>x.classList.remove('active'));
        this.classList.add('active');
      }
    });
  }
}

// Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ + Ø­Ø§Ù„Ø© Ø§Ù„ÙŠÙˆÙ…
const HOURS = [
  {dayIdx:0, key:'Sunday',    range:'09:00 - 19:00', closed:false},
  {dayIdx:1, key:'Monday',    range:'09:00 - 19:00', closed:false},
  {dayIdx:2, key:'Tuesday',   range:'09:00 - 19:00', closed:false},
  {dayIdx:3, key:'Wednesday', range:'09:00 - 19:00', closed:false},
  {dayIdx:4, key:'Thursday',  range:'09:00 - 19:00', closed:false},
  {dayIdx:5, key:'Friday',    range:'09:00 - 19:00', closed:false},
  {dayIdx:6, key:'Saturday',  range:'09:00 - 19:00', closed:false},
];

function buildHours(){
  const list = document.getElementById('hours-list');
  if (!list) return;
  list.innerHTML = '';
  const lang = getLang();
  const dayNames = I18N[lang].hours.days;
  const dayIdx = new Date().getDay(); // 0=Sunday
  HOURS.forEach((h,i)=>{
    const isToday = i===dayIdx;
    const row = document.createElement('div');
    row.className = 'flex justify-between items-center p-3 rounded-lg ' + (isToday ? 'today-row' : 'row-muted');
    const dayName = dayNames[i] || h.key;
    row.innerHTML = `<span class="font-medium">${dayName}</span>
      <span class="${h.closed?'text-red-400':'text-green-400'} font-semibold">${h.range}</span>`;
    list.appendChild(row);
    if(isToday){
      document.getElementById('today-status').textContent = h.closed ? I18N[lang].hours.closedToday : I18N[lang].hours.openNow;
      document.getElementById('today-range').textContent = h.range;
    }
  });
}

// Newsletter demo
function initNewsletter(){
  const news = document.getElementById('newsletter');
  const newsOk = document.getElementById('news-ok');
  if (news && !news._bound) {
    news._bound = true;
    news.addEventListener('submit', e => {
      e.preventDefault();
      newsOk.classList.remove('hidden');
      news.reset();
      setTimeout(()=> newsOk.classList.add('hidden'), 4000);
    });
  }
}

// ======== Ø®Ø±ÙŠØ·Ø© Leaflet ========
async function initMap(){
  const address = '365, Bd El Fida, Casablanca';
  const mapBox = document.getElementById('map');
  if (!mapBox) return;

  try {
    const url = 'https://nominatim.openstreetmap.org/search?format=json&limit=1&addressdetails=1&q=' + encodeURIComponent(address);
    const res = await fetch(url, { headers: { 'Accept-Language': getLang()==='ar'?'ar':'fr' }});
    const data = await res.json();

    if (!Array.isArray(data) || data.length === 0) {
      mapBox.innerHTML = '<div class="p-4 text-center text-sm text-gray-300">ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.</div>';
      return;
    }

    const lat = parseFloat(data[0].lat);
    const lon = parseFloat(data[0].lon);

    const map = L.map('map', { scrollWheelZoom: false }).setView([lat, lon], 16);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    L.marker([lat, lon]).addTo(map).bindPopup('<b>' + address + '</b>').openPopup();

  } catch (err) {
    mapBox.innerHTML = '<div class="p-4 text-center text-sm text-rose-300">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø±ÙŠØ·Ø©.</div>';
    console.error(err);
  }
}

// Ù…Ø¨Ø¯Ù‘Ù„ Ø§Ù„Ù„ØºØ© (Ù‚Ø§Ø¦Ù…Ø© ØµØºÙŠØ±Ø©)
function initLangMenu(){
  const btn = document.getElementById('lang-toggle');
  const menu = document.getElementById('lang-menu');
  if (!btn || !menu) return;
  if (!btn._bound){
    btn._bound = true;
    btn.addEventListener('click', ()=>{
      const open = !menu.classList.contains('hidden');
      if (open) { menu.classList.add('hidden'); btn.setAttribute('aria-expanded','false'); }
      else { menu.classList.remove('hidden'); btn.setAttribute('aria-expanded','true'); }
    });
    document.addEventListener('click', (e)=>{
      if (!menu.contains(e.target) && e.target!==btn && !btn.contains(e.target)){
        menu.classList.add('hidden'); btn.setAttribute('aria-expanded','false');
      }
    });
  }
  menu.querySelectorAll('[data-set-lang]').forEach(item=>{
    if (!item._bound){
      item._bound = true;
      item.addEventListener('click', ()=>{
        const lang = item.getAttribute('data-set-lang');
        setLang(lang);
        menu.classList.add('hidden'); btn.setAttribute('aria-expanded','false');
      });
    }
  });
}

// Modal (placeholder)
let currentProductId=null;
function openPurchaseModal(id){
  currentProductId=id;
  alert(getLang()==='ar' ? 'Ø·Ù„Ø¨ Ø§Ù„Ø´Ø±Ø§Ø¡: Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹.' : 'Demande dâ€™achat : nous vous contacterons bientÃ´t.');
}
function closePurchaseModal(){ currentProductId=null; }

// Image fallback
document.addEventListener('error', e=>{
  const t=e.target;
  if(t && t.tagName==='IMG'){
    t.src='https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=600&fit=crop';
    t.alt='Image de remplacement';
  }
}, true);

// ================== CHRONO (09:00â€“19:00 ÙŠÙˆÙ…ÙŠØ§Ù‹) ==================
function pad(n){ return n.toString().padStart(2,'0'); }
function updateChrono(){
  const now = new Date();

  const start = new Date(now); start.setHours(9,0,0,0);
  const end   = new Date(now); end.setHours(19,0,0,0);

  const statusEl = document.getElementById('chrono-status');
  const remainingEl = document.getElementById('chrono-remaining');
  const hintEl = document.getElementById('chrono-hint');
  const barEl = document.getElementById('chrono-progress-bar');
  const windowEl = document.getElementById('chrono-time-window');

  if(!statusEl || !remainingEl || !hintEl || !barEl) return;
  if(windowEl) windowEl.textContent = '09:00â€“19:00';

  let status = '', hint = '', remainingText = '00:00:00', progress = 0;

  if (now < start) {
    const diff = start - now;
    const h = Math.floor(diff/3_600_000);
    const m = Math.floor((diff%3_600_000)/60_000);
    const s = Math.floor((diff%60_000)/1000);
    status = 'ğŸ“¦ Ø³Ù€Ù†ÙØªØ­ Ø¨Ø¹Ø¯';
    remainingText = `${pad(h)}:${pad(m)}:${pad(s)}`;
    hint = 'Ù†Ø³ØªÙ‚Ø¨Ù„ÙƒÙ… Ù…Ù† 09:00 Ø¥Ù„Ù‰ 19:00';
    progress = 0;
    statusEl.className = 'badge badge-wait';
  } else if (now >= start && now <= end) {
    const diff = end - now;
    const h = Math.floor(diff/3_600_000);
    const m = Math.floor((diff%3_600_000)/60_000);
    const s = Math.floor((diff%60_000)/1000);
    status = 'âœ… Ù…ÙØªÙˆØ­ Ø§Ù„Ø¢Ù†';
    remainingText = `${pad(h)}:${pad(m)}:${pad(s)}`;
    hint = 'ÙŠØºÙ„Ù‚ Ø¹Ù†Ø¯ 19:00';
    const total = end - start;
    progress = ((now - start) / total) * 100;
    statusEl.className = 'badge badge-open';
  } else {
    const tomorrowStart = new Date(now);
    tomorrowStart.setDate(now.getDate() + 1);
    tomorrowStart.setHours(9,0,0,0);
    const diff = tomorrowStart - now;
    const h = Math.floor(diff/3_600_000);
    const m = Math.floor((diff%3_600_000)/60_000);
    const s = Math.floor((diff%60_000)/1000);
    status = 'â›” Ù…ØºÙ„Ù‚ Ø§Ù„Ø¢Ù†';
    remainingText = `${pad(h)}:${pad(m)}:${pad(s)}`;
    hint = 'Ù†ÙØªØ­ ØºØ¯Ù‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø§Ø¹Ø© 09:00';
    progress = 100;
    statusEl.className = 'badge badge-close';
  }

  statusEl.textContent = status;
  remainingEl.textContent = remainingText;
  hintEl.textContent = hint;
  barEl.style.width = progress + '%';
}

// ================== INIT ==================
document.addEventListener('DOMContentLoaded', async () => {
  // Set default language and load translations
  const initialLang = getLang();
  await setLang(initialLang); // This will also call applyTranslations and set dir/lang attributes

  // Theme
  initTheme();

  // Language menu
  initLangMenu();

  // Router
  router = new Router();
  enableSmoothNav();

  // Store Hours
  buildHours();

  // Newsletter
  initNewsletter();

  // Map
  await initMap();

  // Chrono
  updateChrono();
  setInterval(updateChrono, 1000);
});
